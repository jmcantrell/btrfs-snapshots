#!/usr/bin/env bash

set -eu

pkg_name=btrfs-snapshots
src_dir=$PWD
dst_dir=${INSTALL_ROOT:-/usr/local}

mkdir -p "$dst_dir"
cd "$dst_dir"

install -m755 -Dt ./bin "$src_dir"/bin/*

install -m644 -Dt ./lib/"$pkg_name" "$src_dir"/lib/*

for file in "$src_dir"/man/*; do
    filename=$(basename "$file")
    section=${filename##*.}
    install -m644 -DT "$file" ./share/man/man"$section"/"$filename"
done

install -m644 -Dt ./lib/systemd/system "$src_dir"/systemd/*

install -m644 -Dt ./share/doc/"$pkg_name"/config "$src_dir"/config/*

install -m644 -Dt ./share/doc/"$pkg_name" "$src_dir"/{README,LICENSE}.md

for file in "$src_dir"/completion/*.zsh; do
    name=$(basename "$file" .zsh)
    install -m644 -DT "$file" ./share/zsh/site-functions/_"$name"
done

for file in "$src_dir"/completion/*.bash; do
    name=$(basename "$file" .bash)
    install -m644 -DT "$file" ./share/bash-completion/completions/"$name"
done
