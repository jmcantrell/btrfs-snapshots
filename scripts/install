#!/usr/bin/env bash

set -euo pipefail

ROOT_DIR=$PWD

mkdir -p "${DEST_DIR:-}${PREFIX:-/usr/local}"
cd "$_"

install -d ./bin
install -pm 0755 "$ROOT_DIR"/bin/* "$_"

install -d ./lib/btrfs-snapshots
install -pm 0644 "$ROOT_DIR"/lib/*.* "$_"

for file in "$ROOT_DIR"/man/*.[1-8]; do
    base=$(basename "$file")
    section=${base##*.}
    install -d ./share/man/man"$section"
    install -pm 0644 "$file" "$_"/"$base"
done

install -d ./lib/systemd/system
install -pm 0644 "$ROOT_DIR"/systemd/* "$_"

install -d ./share/doc/btrfs-snapshots/etc
install -pm 0644 "$ROOT_DIR"/etc/*.conf "$_"

install -d ./share/doc/btrfs-snapshots/etc/profile.d
install -pm 0644 "$ROOT_DIR"/etc/profile.d/*.conf "$_"

install -d ./share/doc/btrfs-snapshots
install -pm 0644 "$ROOT_DIR"/{README,LICENSE}* "$_"

for file in "$ROOT_DIR"/completion/*.zsh; do
    name=$(basename "$file" .zsh)
    install -d ./share/zsh/site-functions
    install -pm 0644 "$file" "$_"/_"$name"
done

for file in "$ROOT_DIR"/completion/*.bash; do
    name=$(basename "$file" .bash)
    install -d ./share/bash-completion/completions
    install -pm 0644 "$file" "$_"/"$name"
done
